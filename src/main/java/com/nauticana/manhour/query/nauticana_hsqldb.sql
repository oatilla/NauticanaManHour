CREATE TABLE USER_ACCOUNT (
  USERNAME         VARCHAR(30) NOT NULL,
  PASSWORD         VARCHAR(30) NOT NULL,
  CAPTION          VARCHAR(30) NOT NULL,
  STATUS           CHAR(1)     NOT NULL
);

ALTER TABLE USER_ACCOUNT
  ADD CONSTRAINT USER_ACCOUNT_PK
      PRIMARY KEY (USERNAME);

CREATE TABLE AUTHORITY_GROUP (
  AUTHORITY_GROUP  VARCHAR(30) NOT NULL,
  CAPTION          VARCHAR(30) NOT NULL
);

ALTER TABLE AUTHORITY_GROUP
  ADD CONSTRAINT AUTHORITY_GROUP_PK
      PRIMARY KEY (AUTHORITY_GROUP);



CREATE TABLE TABLE_AUTHORIZATION (
  AUTHORITY_GROUP  VARCHAR(30) NOT NULL,
  TABLENAME        VARCHAR(30) NOT NULL,
  ALLOW_SELECT     CHAR(1)      DEFAULT '-' NOT NULL,
  ALLOW_UPDATE     CHAR(1)      DEFAULT '-' NOT NULL,
  ALLOW_INSERT     CHAR(1)      DEFAULT '-' NOT NULL,
  ALLOW_DELETE     CHAR(1)      DEFAULT '-' NOT NULL
);

ALTER TABLE TABLE_AUTHORIZATION
  ADD CONSTRAINT TABLE_AUTHORIZATION_PK
      PRIMARY KEY (AUTHORITY_GROUP,TABLENAME);

ALTER TABLE TABLE_AUTHORIZATION
  ADD CONSTRAINT TABLE_AUTHORIZATION_FK1
      FOREIGN KEY (AUTHORITY_GROUP)
      REFERENCES AUTHORITY_GROUP (AUTHORITY_GROUP);



CREATE TABLE MAIN_MENU (
  MENU             VARCHAR(30) NOT NULL,
  CAPTION          VARCHAR(30) NOT NULL,
  ICON             VARCHAR(30) NOT NULL,
  DISPLAY_ORDER    SMALLINT     NOT NULL
);

ALTER TABLE MAIN_MENU
  ADD CONSTRAINT MAIN_MENU_PK
      PRIMARY KEY (MENU);



CREATE TABLE SCREEN_PAGE (
  PAGENAME         VARCHAR(30)  NOT NULL,
  CAPTION          VARCHAR(30)  NOT NULL,
  ICON             VARCHAR(30)  NOT NULL,
  URL              VARCHAR(100) NOT NULL,
  MENU             VARCHAR(30)  NOT NULL,
  DISPLAY_ORDER    SMALLINT     NOT NULL
);

ALTER TABLE SCREEN_PAGE
  ADD CONSTRAINT SCREEN_PAGE_PK
      PRIMARY KEY (PAGENAME);

ALTER TABLE SCREEN_PAGE
  ADD CONSTRAINT SCREEN_PAGE_FK1
      FOREIGN KEY (MENU)
      REFERENCES MAIN_MENU (MENU);



CREATE TABLE PAGE_AUTHORIZATION (
  AUTHORITY_GROUP  VARCHAR(30) NOT NULL,
  PAGENAME         VARCHAR(30) NOT NULL
);

ALTER TABLE PAGE_AUTHORIZATION
  ADD CONSTRAINT PAGE_AUTHORIZATION_PK
      PRIMARY KEY (AUTHORITY_GROUP, PAGENAME);

ALTER TABLE PAGE_AUTHORIZATION
  ADD CONSTRAINT PAGE_AUTHORIZATION_FK1
      FOREIGN KEY (AUTHORITY_GROUP)
      REFERENCES AUTHORITY_GROUP (AUTHORITY_GROUP);

ALTER TABLE PAGE_AUTHORIZATION
  ADD CONSTRAINT PAGE_AUTHORIZATION_FK2
      FOREIGN KEY (PAGENAME)
      REFERENCES SCREEN_PAGE (PAGENAME);



CREATE TABLE USER_AUTHORIZATION (
   USERNAME           VARCHAR(30) NOT NULL,
   AUTHORITY_GROUP    VARCHAR(30) NOT NULL
);

ALTER TABLE USER_AUTHORIZATION
  ADD CONSTRAINT USER_AUTHORIZATION_PK
      PRIMARY KEY (USERNAME,AUTHORITY_GROUP);

ALTER TABLE USER_AUTHORIZATION
  ADD CONSTRAINT USER_AUTHORIZATION_FK1
      FOREIGN KEY (AUTHORITY_GROUP)
      REFERENCES AUTHORITY_GROUP (AUTHORITY_GROUP);

ALTER TABLE USER_AUTHORIZATION
  ADD CONSTRAINT USER_AUTHORIZATION_FK2
      FOREIGN KEY (USERNAME)
      REFERENCES USER_ACCOUNT (USERNAME);



CREATE TABLE DOMAIN_NAME (
   DOMAIN         VARCHAR(30) NOT NULL,
   KEYSIZE        SMALLINT    NOT NULL,
   CAPTION        VARCHAR(30) NOT NULL
);

ALTER TABLE DOMAIN_NAME
  ADD CONSTRAINT DOMAIN_NAME_PK
      PRIMARY KEY (DOMAIN);



CREATE TABLE DOMAIN_VALUE(
   DOMAIN         VARCHAR(30) NOT NULL,
   REFVALUE       VARCHAR(30) NOT NULL,
   CAPTION        VARCHAR(30) NOT NULL
);

ALTER TABLE DOMAIN_VALUE
  ADD CONSTRAINT DOMAIN_VALUE_PK
      PRIMARY KEY (DOMAIN,REFVALUE);

ALTER TABLE DOMAIN_VALUE
  ADD CONSTRAINT DOMAIN_VALUE_FK1
      FOREIGN KEY (DOMAIN)
      REFERENCES DOMAIN_NAME (DOMAIN);



CREATE TABLE DOMAIN_LOOKUP(
   DOMAIN         VARCHAR(30) NOT NULL,
   TABLENAME      VARCHAR(30) NOT NULL,
   FIELDNAME      VARCHAR(30) NOT NULL
);

ALTER TABLE DOMAIN_LOOKUP
  ADD CONSTRAINT DOMAIN_LOOKUP_FK1
      FOREIGN KEY (DOMAIN)
      REFERENCES DOMAIN_NAME (DOMAIN);



CREATE TABLE LANGUAGE(
   LANGCODE       VARCHAR(2)  NOT NULL,
   CAPTION        VARCHAR(30) NOT NULL
);

ALTER TABLE LANGUAGE
  ADD CONSTRAINT LANGUAGE_PK
      PRIMARY KEY (LANGCODE);



CREATE TABLE CAPTION_TRANSLATION (
   CAPTION        VARCHAR(30) NOT NULL,
   LANGCODE       VARCHAR(2)  NOT NULL,
   LABELUPPER     VARCHAR(80) NOT NULL,
   LABELLOWER     VARCHAR(80) NOT NULL
);

ALTER TABLE CAPTION_TRANSLATION
  ADD CONSTRAINT CAPTION_TRANSLATION_PK
      PRIMARY KEY (CAPTION,LANGCODE);

ALTER TABLE CAPTION_TRANSLATION
  ADD CONSTRAINT CAPTION_TRANSLATION_FK1
      FOREIGN KEY (LANGCODE)
      REFERENCES LANGUAGE (LANGCODE);



INSERT INTO USER_ACCOUNT (USERNAME,PASSWORD,CAPTION,STATUS) VALUES ('MUSTAFA', '1', 'MUSTAFA KARLI', 'A');
INSERT INTO USER_ACCOUNT (USERNAME,PASSWORD,CAPTION,STATUS) VALUES ('ADMIN',   'admin', 'Administrator', 'A');

INSERT INTO AUTHORITY_GROUP (AUTHORITY_GROUP,CAPTION) VALUES ('ADMINISTRATOR', 'ADMINISTRATOR');
INSERT INTO AUTHORITY_GROUP (AUTHORITY_GROUP,CAPTION) VALUES ('GUEST', 'GUEST');

INSERT INTO MAIN_MENU (MENU, CAPTION, ICON, DISPLAY_ORDER) VALUES ('SETTINGS', 'SETTINGS', 'settings.png', 9990);

INSERT INTO SCREEN_PAGE (PAGENAME,CAPTION,ICON,URL,MENU,DISPLAY_ORDER) VALUES ('AUTHORITY_GROUP', 'AUTHORITY_GROUP', 'group.png',  'authorityGroup/list', 'SETTINGS', 10);
INSERT INTO SCREEN_PAGE (PAGENAME,CAPTION,ICON,URL,MENU,DISPLAY_ORDER) VALUES ('MENU',            'MENU',            'menu.png',   'menu/list',           'SETTINGS', 20);
INSERT INTO SCREEN_PAGE (PAGENAME,CAPTION,ICON,URL,MENU,DISPLAY_ORDER) VALUES ('USER_ACCOUNT',    'USER_ACCOUNT',    'user.png',   'user/list',           'SETTINGS', 30);
INSERT INTO SCREEN_PAGE (PAGENAME,CAPTION,ICON,URL,MENU,DISPLAY_ORDER) VALUES ('DOMAIN',          'DOMAIN',          'domain.png', 'domain/list',         'SETTINGS', 40);
INSERT INTO SCREEN_PAGE (PAGENAME,CAPTION,ICON,URL,MENU,DISPLAY_ORDER) VALUES ('LANGUAGE',        'LANGUAGE',        'language',   'language/list',       'SETTINGS', 50);

INSERT INTO PAGE_AUTHORIZATION (AUTHORITY_GROUP,PAGENAME) VALUES ('ADMINISTRATOR', 'AUTHORITY_GROUP');
INSERT INTO PAGE_AUTHORIZATION (AUTHORITY_GROUP,PAGENAME) VALUES ('ADMINISTRATOR', 'MENU');
INSERT INTO PAGE_AUTHORIZATION (AUTHORITY_GROUP,PAGENAME) VALUES ('ADMINISTRATOR', 'USER_ACCOUNT');
INSERT INTO PAGE_AUTHORIZATION (AUTHORITY_GROUP,PAGENAME) VALUES ('ADMINISTRATOR', 'DOMAIN');
INSERT INTO PAGE_AUTHORIZATION (AUTHORITY_GROUP,PAGENAME) VALUES ('ADMINISTRATOR', 'LANGUAGE');

INSERT INTO USER_AUTHORIZATION (USERNAME,AUTHORITY_GROUP) VALUES ('MUSTAFA', 'ADMINISTRATOR');
INSERT INTO USER_AUTHORIZATION (USERNAME,AUTHORITY_GROUP) VALUES ('ADMIN',   'ADMINISTRATOR');

INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'AUTHORITY_GROUP', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'TABLE_AUTHORIZATION', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'USER_ACCOUNT', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'USER_AUTHORIZATION', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'DOMAIN_NAME', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'DOMAIN_VALUE', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'DOMAIN_LOOKUP', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'LANGUAGE', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'CAPTION_TRANSLATION', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'MAIN_MENU', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'SCREEN_PAGE', '+', '+', '+', '+');
INSERT INTO TABLE_AUTHORIZATION (AUTHORITY_GROUP,TABLENAME,ALLOW_SELECT,ALLOW_UPDATE,ALLOW_INSERT,ALLOW_DELETE) VALUES ('ADMINISTRATOR', 'PAGE_AUTHORIZATION', '+', '+', '+', '+');

INSERT INTO LANGUAGE (LANGCODE, CAPTION) VALUES ('TR', 'TURKISH');
INSERT INTO LANGUAGE (LANGCODE, CAPTION) VALUES ('EN', 'ENGLISH');

INSERT INTO DOMAIN_NAME (DOMAIN,KEYSIZE,CAPTION) VALUES ('USER_STATUS',1,'USER_STATUS');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('USER_STATUS','A','ACTIVE');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('USER_STATUS','I','INITIAL');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('USER_STATUS','E','EXPIRED');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('USER_STATUS','L','LOCKED');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('USER_STATUS','S','ADMINLOCK');

INSERT INTO DOMAIN_NAME (DOMAIN,KEYSIZE,CAPTION) VALUES ('YESNO',1,'YESNO');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('YESNO','+','YES');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('YESNO','-','NO');

INSERT INTO DOMAIN_NAME (DOMAIN,KEYSIZE,CAPTION) VALUES ('DAYS',1,'DAYS');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('DAYS','1','MONDAY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('DAYS','2','TUESDAY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('DAYS','3','WEDNESDAY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('DAYS','4','THURSDAY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('DAYS','5','FRIDAY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('DAYS','6','SATURDAY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('DAYS','7','SUNDAY');

INSERT INTO DOMAIN_NAME (DOMAIN,KEYSIZE,CAPTION) VALUES ('MONTHS',2,'MONTHS');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','01','JANUARY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','02','FEBRUARY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','03','MARCH');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','04','APRIL');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','05','MAY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','06','JUNE');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','07','JULY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','08','AUGUST');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','09','SEPTEMBER');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','10','OCTOBER');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','11','NOVEMBER');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('MONTHS','12','DECEMBER');

INSERT INTO DOMAIN_NAME (DOMAIN,KEYSIZE,CAPTION) VALUES ('PERIOD_TYPE',1,'PERIOD_TYPE');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('PERIOD_TYPE','H','HOURLY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('PERIOD_TYPE','D','DAILY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('PERIOD_TYPE','W','WEEKLY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('PERIOD_TYPE','M','MONTHLY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('PERIOD_TYPE','Q','QUARTERLY');
INSERT INTO DOMAIN_VALUE (DOMAIN,REFVALUE,CAPTION) VALUES ('PERIOD_TYPE','Y','YEARLY');

CREATE VIEW USER_MENU_PERMISSION AS
SELECT DISTINCT
       U.USERNAME,
       P.PAGENAME,
       P.CAPTION AS PAGE_CAPTION,
       P.ICON AS PAGE_ICON,
       P.URL,
       M.MENU,
       M.CAPTION AS MENU_CAPTION,
       M.ICON AS MENU_ICON,
       M.DISPLAY_ORDER AS MENU_ORDER,
       P.DISPLAY_ORDER AS PAGE_ORDER
  FROM PAGE_AUTHORIZATION T, USER_AUTHORIZATION U, SCREEN_PAGE P, MAIN_MENU M
 WHERE T.AUTHORITY_GROUP=U.AUTHORITY_GROUP
   AND P.PAGENAME=T.PAGENAME
   AND M.MENU=P.MENU;

CREATE VIEW USER_TABLE_SELECT_PERMISSION AS
SELECT U.USERNAME, T.TABLENAME, COUNT(*) AS CNT
  FROM TABLE_AUTHORIZATION T, USER_AUTHORIZATION U
 WHERE T.AUTHORITY_GROUP=U.AUTHORITY_GROUP
   AND T.ALLOW_SELECT='+'
 GROUP BY U.USERNAME, T.TABLENAME;

CREATE VIEW USER_TABLE_INSERT_PERMISSION AS
SELECT U.USERNAME, T.TABLENAME, COUNT(*) AS CNT
  FROM TABLE_AUTHORIZATION T, USER_AUTHORIZATION U
 WHERE T.AUTHORITY_GROUP=U.AUTHORITY_GROUP
   AND T.ALLOW_INSERT='+'
 GROUP BY U.USERNAME, T.TABLENAME;

CREATE VIEW USER_TABLE_UPDATE_PERMISSION AS
SELECT U.USERNAME, T.TABLENAME, COUNT(*) AS CNT
  FROM TABLE_AUTHORIZATION T, USER_AUTHORIZATION U
 WHERE T.AUTHORITY_GROUP=U.AUTHORITY_GROUP
   AND T.ALLOW_UPDATE='+'
 GROUP BY U.USERNAME, T.TABLENAME;

CREATE VIEW USER_TABLE_DELETE_PERMISSION AS
SELECT U.USERNAME, T.TABLENAME, COUNT(*) AS CNT
  FROM TABLE_AUTHORIZATION T, USER_AUTHORIZATION U
 WHERE T.AUTHORITY_GROUP=U.AUTHORITY_GROUP
   AND T.ALLOW_DELETE='+'
 GROUP BY U.USERNAME, T.TABLENAME;
